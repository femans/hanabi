extends layout

block js
  script(src="../javascripts/jquery-2.1.3.min.js")
  script(src="../javascripts/arena.js")

block content
  - var turn = game.hisTurn(player)&&game.lives>0&&game.stock.length>0
  - var whosTurn = game.hisTurn(player)?'your':game.whosTurn()+"'s"
  .header
    h1= 'Welcome, ' + player
    .error
    if game.lives==0
      h2 GAME OVER 
    else 
      if game.stock.length==0
        h2 WIN! WIN! - #{game.points()} points
      else  
        h2 It is <span class="playerturn">#{whosTurn}</span> turn
  
  .main
    .sidepanel
      each card in game.discardPile()
        .card(style='background-color:'+card.color)
          div=card.number
    .arena
      .pile
        .pile_place
          .card.stock 
            .stocksize=game.stock.length
          .description stock
        .pile_place
          if game.discard.length>0
            .card.discardpile(style='background-color:'+game.discardPile()[0].color)
              div=game.discardPile()[0].number
            .description discard
          else
            .card.discardpile
            .description discard
        .pile_place
          .card
            .hints=game.hints
          .description hints 
        .pile_place
          .card
            .lives=game.lives
          .description lives 
        .pile_place
          .card
            .points=game.points()
          .description points

      .table
        each numbers, color in game.game_table() 
          .colorclass(class=color)
            each number in numbers
              .card(style='background-color:'+color)
                div=number

    .players
      .yourHand.player(js_turn=turn?'true':'false', js_game=game.id, js_player=player)
        h3 your hand:
        .hand
          each card in game.yourHand(player)
            .card.selectable(js_function='known' style='background-color:'+card.color)
              div= card.number
          .card_options.controls
            button.card_option.discard_card discard
            button.card_option.play_card play
            
      
      each otherPlayer in game.otherPlayers(player)
        .player(js_player=otherPlayer.name)
          h3= otherPlayer.name + "'s hand"
          .playerCards
            .hand
              each card in otherPlayer.cards()
                .cardholder
                  .card(style='background-color:'+card.color)
                    div= card.number
                  - var color=card.colorKnown?card.color:'black'
                  - var number=card.numberKnown?card.number:'?'
                  .knowncard(js_function='known' style='color:'+color)
                    div=number

            if game.hints>0 && game.lives>0
              div(js_turn=turn?'true':'false')
                table.controls
                  tr
                    td hint:
                    each color in otherPlayer.hints().colors
                      td.hintButton(js_game=game.id, js_player=player,js_hint='color', js_val=color, js_for=otherPlayer.name, style='background-color:'+color)
                    each number in otherPlayer.hints().numbers
                      td.hintButton(js_game=game.id, js_player=player, js_hint='number', js_val=number, js_for=otherPlayer.name)=number

  // open a socket:
  script(src="/socket.io/socket.io.js")
  script SOCKET = io();
  script PLAYER = '#{player}'
